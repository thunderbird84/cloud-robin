var JSObject={extend:function(a){return $this=function(a){if("object"==typeof a)for(var b in a)a.hasOwnProperty(b)&&(this[b]=a[b]);else"string"==typeof a&&(this.elm=document.getElementById(a));"function"==typeof this.init&&this.init()},_props=a||{},_props.toString=function(){return this.type?this.type:"JSObject"},$this.prototype=_props||{},$this}},RandSquare=JSObject.extend({type:"RandSquare",size:9,currentScope:0,squareWith:32,canvases:[],colors:["#29088A","#2E2EFE","#8A4B08","#0B3B17","#3104B4","#FA5882","#DF01A5","#B40404","#088A4B"],init:function(){for(this.elm?this.parent=this.elm:this.parent=document.body,this.randCount=0,this.groupSize=Math.sqrt(this.size),this.container=document.createElement("DIV"),this.container.className="gameBoard",this.container.style.margin="0 auto",this.container.style.width=this.size*(this.squareWith+1),this.container.style.height=this.size*(this.squareWith+1),this.container.style.borderRight="1px solid",this.container.style.borderBottom="1px solid",this.randText=document.createElement("SPAN"),this.randText.id="randText",this.randText.style.color="brown",this.randText.style.fontSize="16px",this.randText.style.fontWeight="bold",this.getRandNumber(),this.parent.appendChild(this.randText),this.scopeText=document.createElement("SPAN"),this.scopeText.id="scopeText",this.scopeText.style.color="red",this.scopeText.style.fontSize="16px",this.scopeText.style.fontWeight="bold",this.parent.appendChild(this.scopeText),this.parent.appendChild(this.container),i=0;i<this.size;i++)for(this.canvases[i]=[],j=0;j<this.size;j++)this.canvases[i][j]=document.createElement("CANVAS"),oCanvas=this.canvases[i][j],oCanvas.id="square"+i+"_"+j,oCanvas.style.width=this.squareWith,oCanvas.style.height=this.squareWith,oCanvas.className="square "+(j==this.size-1?"large ":"")+(i==this.size-1?"large1 ":""),oCanvas.width=2*this.squareWith,oCanvas.height=2*this.squareWith,oCanvas.style.borderLeft="1px solid",oCanvas.style.borderTop="1px solid",onclickHandler=this.squareClick,oCanvas.mainSquare=this,oCanvas.yIdx=i,oCanvas.xIdx=j,oCanvas.addEventListener("click",function(a){this.mainSquare.squareClick(this,a)},!1),this.container.appendChild(this.canvases[i][j])},squareClick:function(a,b){if("undefined"==typeof a.weightNum){var c=this.getRandNumber();if(0!=c.length){var d=this.findTopOfGroup(a),e=d.xIdx;for(strtmpLog="<br/>Set weigh:",i=0;i<this.groupSize;i++){var f=d.yIdx+i;g=this.canvases[f][e],this.canvases[f][e].weightNum=c[i],strtmpLog+="--("+f+","+e+"):"+g.weightNum.toString()+"&nbsp;",tmpCtx=g.getContext("2d"),tmpCtx.font="36pt Courier New Bold",tmpCtx.fillStyle=""+this.colors[c[i]],tmpCtx.fillText(c[i],g.width/2-10,g.height/2+10)}for(this.writeLog(strtmpLog),this.writeLog("<br/>Calc:"),i=0;i<this.groupSize;i++){var f=d.yIdx+i;g=this.canvases[f][e],this.writeLog("<br/>("+f+","+e+")="+g.weightNum+"*"),this.calculateMarks(g)}for(this.writeLog("<br/>"),i=0;i<this.size;i++)for(j=0;j<this.size;j++){var g=this.canvases[i][j],h=g.getContext("2d");h.beginPath(),g.vertical&&!g.isVertical&&(h.moveTo(g.width/2,0),h.lineTo(g.width/2,g.height),g.isVertical=!0),g.horizontal&&!g.isHorizontal&&(h.moveTo(0,g.height/2),h.lineTo(g.width,g.height/2),g.isHorizontal=!0),g.leftUpRightDown&&!g.isLeftUpRightDown&&(h.moveTo(0,0),h.lineTo(g.width,g.height),g.isLeftUpRightDown=!0),g.rightUpLeftDown&&!g.isRightUpLeftDown&&(h.moveTo(0,g.width),h.lineTo(g.height,0),g.isRightUpLeftDown=!0),h.closePath(),h.strokeStyle="#000000",h.lineWidth=1,h.stroke()}if(this.randCount>this.size*this.groupSize){for(var k=0,l="{map:[",f=0;f<this.size;f++){l+="[";for(var e=0;e<this.size;e++){var g=this.canvases[f][e];g.mark&&(k+=parseInt(g.mark)),l+=g.weightNum+","}l+="],"}l+="],random:["+this.RandomArray+"]}",this.randText.style.color="red",this.randText.innerHTML="Score:"+k,this.scopeText.innerHTML="",this.onSuccess&&this.onSuccess(l)}else this.scopeText.innerHTML="&nbsp;&nbsp;&nbsp;&nbsp;Score:"+this.currentScope}}},clearLogger:function(){document.getElementById("logger")&&(document.getElementById("logger").innerHTML="")},writeLog:function(a){(logger=document.getElementById("logger"))&&(tmpSpan=document.createElement("SPAN"),tmpSpan.innerHTML=a,logger.firstChild?logger.insertBefore(tmpSpan,logger.firstChild):logger.appendChild(tmpSpan))},getRandNumber:function(){var a=""+Math.random();this.randCount++;var b=this.groupSize,c=[];for(i=0;i<b;i++)c[i]=a.charAt(a.length-i-1);return this.RandomArray||(this.RandomArray=[]),this.RandomArray[this.RandomArray.length]="["+c+"]",this.randText.innerHTML=c,this.randNum?(tmp=this.randNum,this.randNum=c,c=tmp):(this.randNum=c,[])},findTopOfGroup:function(a){var b=a.yIdx%this.groupSize;return this.canvases[a.yIdx-b][a.xIdx]},mostTop:function(a){tmpSqr=a;for(var b=a.yIdx;"undefined"!=typeof tmpSqr.weightNum&&b>=0&&(tmpSqr=this.canvases[b][a.xIdx],tmpSqr.weightNum==a.weightNum);)b--;return b==a.yIdx?a:b<0?this.canvases[0][a.xIdx]:this.canvases[b+1][a.xIdx]},mostBottom:function(a){tmpSqr=a;for(var b=a.yIdx;"undefined"!=typeof tmpSqr.weightNum&&b<this.size&&(tmpSqr=this.canvases[b][a.xIdx],tmpSqr.weightNum==a.weightNum);)b++;return b==a.yIdx?a:b>this.size-1?this.canvases[this.size-1][a.xIdx]:this.canvases[b-1][a.xIdx]},mostLeft:function(a){a.weightNum||alert("error"),tmpSqr=a;for(var b=a.xIdx,c=a.yIdx;"undefined"!=typeof tmpSqr.weightNum&&b>=0&&(tmpSqr=this.canvases[c][b],"undefined"!=typeof tmpSqr.weightNum&&tmpSqr.weightNum==a.weightNum);)b--;return b==a.xIdx?a:b<0?this.canvases[a.yIdx][0]:this.canvases[c][b+1]},mostRight:function(a){for(var b=a,c=a.xIdx;"undefined"!=typeof b.weightNum&&c<this.size&&(b=this.canvases[a.yIdx][c],"undefined"!=typeof b.weightNum&&b.weightNum==a.weightNum);)c++;return c==a.xIdx?a:c>this.size-1?this.canvases[a.yIdx][this.size-1]:this.canvases[a.yIdx][c-1]},mostTopLeft:function(a){for(var b=a,c=a.xIdx,d=a.yIdx;"undefined"!=typeof b.weightNum&&c>0&&d>0&&(b=this.canvases[d][c],b.weightNum==a.weightNum);)c--,d--;return c==a.xIdx||d==a.yIdx?a:0==c&&0!=d&&this.canvases[d][0].weightNum==a.weightNum?this.canvases[d][0]:0==d&&0!=c&&this.canvases[0][c].weightNum==a.weightNum?this.canvases[0][c]:0==c&&0==d&&this.canvases[0][0].weightNum==a.weightNum?this.canvases[0][0]:this.canvases[d+1][c+1]},mostBottomRight:function(a){for(var b=a,c=a.xIdx,d=a.yIdx;"undefined"!=typeof b.weightNum&&c<this.size-1&&d<this.size-1&&(b=this.canvases[d][c],b.weightNum==a.weightNum);)c++,d++;return c==a.xIdx||d==a.yIdx?a:c==this.size-1&&d!=this.size-1&&this.canvases[d][this.size-1].weightNum==a.weightNum?this.canvases[d][this.size-1]:d==this.size-1&&c!=this.size-1&&this.canvases[this.size-1][c].weightNum==a.weightNum?this.canvases[this.size-1][c]:d==this.size-1&&c==this.size-1&&this.canvases[this.size-1][this.size-1].weightNum==a.weightNum?this.canvases[this.size-1][this.size-1]:this.canvases[d-1][c-1]},mostTopRight:function(a){for(var b=a,c=a.xIdx,d=a.yIdx;"undefined"!=typeof b.weightNum&&c<this.size-1&&d>0&&(b=this.canvases[d][c],b.weightNum==a.weightNum);)c++,d--;return c==a.xIdx&&d==a.yIdx?a:c==this.size-1&&0!=d&&this.canvases[d][this.size-1].weightNum==a.weightNum?this.canvases[d][this.size-1]:0==d&&c!=this.size-1&&this.canvases[0][c].weightNum==a.weightNum?this.canvases[0][c]:0==d&&c==this.size-1&&this.canvases[0][this.size-1].weightNum==a.weightNum?this.canvases[0][this.size-1]:this.canvases[++d][--c]},mostBottomLeft:function(a){for(var b=a,c=a.xIdx,d=a.yIdx;"undefined"!=typeof b.weightNum&&c>0&&d<this.size-1&&(b=this.canvases[d][c],b.weightNum==a.weightNum);)c--,d++;return c==a.xIdx&&d==a.yIdx?a:d==this.size-1&&0!=c&&this.canvases[this.size-1][c].weightNum==a.weightNum?this.canvases[this.size-1][c]:0==c&&d!=this.size-1&&this.canvases[d][0].weightNum==a.weightNum?this.canvases[d][0]:0==c&&d==this.size-1&&this.canvases[this.size-1][0].weightNum==a.weightNum?this.canvases[this.size-1][0]:this.canvases[--d][++c]},calculateMarks:function(a){if("undefined"==typeof a.weightNum)return void this.writeLog("<br/>undefined : of("+a.yIdx+","+a.xIdx+")");var b=this.mostTop(a),c=this.mostBottom(a),d=b.xIdx;if(Math.abs(c.yIdx-b.yIdx)>=this.groupSize-1)for(var e=b.yIdx;e<=c.yIdx;e++)this.canvases[e][d].mark||(this.canvases[e][d].mark=0==a.weightNum?10:a.weightNum,this.currentScope+=parseInt(this.canvases[e][d].mark)),this.canvases[e][d].vertical=1;var f=this.mostLeft(a),g=this.mostRight(a),e=f.yIdx;if(Math.abs(g.xIdx-f.xIdx)>=this.groupSize-1)for(var d=f.xIdx;d<=g.xIdx;d++)this.canvases[e][d].mark||(this.canvases[e][d].mark=0==a.weightNum?10:a.weightNum,this.currentScope+=parseInt(this.canvases[e][d].mark)),this.canvases[e][d].horizontal=1;var h=this.mostTopLeft(a),i=this.mostBottomRight(a);if(Math.abs(h.xIdx-i.xIdx)>=this.groupSize-1)for(var e=h.yIdx,d=h.xIdx;d<=i.xIdx;d++)this.canvases[e][d].mark||(this.canvases[e][d].mark=0==a.weightNum?10:a.weightNum,this.currentScope+=parseInt(this.canvases[e][d].mark)),this.canvases[e][d].leftUpRightDown=1,e++;var j=this.mostTopRight(a),k=this.mostBottomLeft(a);if(this.writeLog("<br/>mostBottomLeft: of("+a.yIdx+","+a.xIdx+") is ("+k.yIdx+","+k.xIdx+")="+k.weightNum+"=>"+Math.abs(j.yIdx-k.yIdx)),Math.abs(k.xIdx-j.xIdx)>=this.groupSize-1)for(var d=k.xIdx,e=k.yIdx;e>=j.yIdx;e--)this.canvases[e][d].mark||(this.canvases[e][d].mark=0==a.weightNum?10:a.weightNum,this.currentScope+=parseInt(this.canvases[e][d].mark)),this.canvases[e][d].rightUpLeftDown=1,d++},setSuccessCalback:function(a){if("function"!=typeof a)throw"onSuccess must be Function";this.onSuccess=a}}),$$=JSObject.extend({toString:function(){return"FramworkJs"}});